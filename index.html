<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cook Alone Club</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <!-- Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <!-- Stripe.js -->
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDcZ8WtDN97yn2Kr2357oMVCJLFc_pnX-8",
      authDomain: "cook-along-club.firebaseapp.com",
      projectId: "cook-along-club",
      storageBucket: "cook-along-club.firebasestorage.app",
      messagingSenderId: "28924148794",
      appId: "1:28924148794:web:5c65b097c587692ae34903",
      measurementId: "G-NQLWEF2TMZ"
    };
    firebase.initializeApp(firebaseConfig);

    // Stripe test publishable key
    const stripe = Stripe("pk_live_51RbQtwDapoQuKUdmB7Z2yjibZsrNsRyOgVAKEmB3pRhtLo7Kzv9Rkc6xuKwyGDMTImoDbZ4EZYQQZP5wFrXswIlE0039dIMkDG");
  </script>
</head>
<body>
  <header>
    <h1>üç≥ Cook Alone Club</h1>
    <nav>
      <a href="#">Home</a>
      <a href="recipies.html">Recipes</a>
      <a href="#">Meal Plans</a>
    </nav>
    <div id="auth-buttons" style="display: flex; align-items: center;">
      <button id="loginBtn" class="auth-btn">Sign In</button>
      <div id="profileWrapper" style="display: none; align-items: center;">
        <img id="userPic" src="" alt="Profile" class="profile-pic" />
        <button id="logoutBtn" class="auth-btn">Logout</button>
      </div>
    </div>
  </header>

  <section id="home" class="hero-v2">
    <div class="hero-glass">
      <h1>Cook Alone Club üë®‚Äçüç≥</h1>
      <p>Weekly interactive recipes, video cook-alongs, and exclusive member perks. Join the new way to learn cooking!</p>
      <button id="joinBtn" class="cta modern">Join Now</button>
    </div>
  </section>

  <section id="recipes" class="recipes-section">
    <h2>Exclusive Recipes üçΩÔ∏è</h2>
    <div class="recipe-grid">
      <div class="recipe-card">
        <img src="SpicyGarlicNoodles.jpg" alt="Spicy Garlic Noodles" />
        <div class="recipe-content">
          <h3>Spicy Garlic Noodles</h3>
          <span class="tag members">Members Only</span>
          <button>View Recipe</button>
        </div>
      </div>
      <div class="recipe-card">
        <img src="quickvegacurry.jpg" alt="Quick Vegan Curry" />
        <div class="recipe-content">
          <h3>Quick Vegan Curry</h3>
          <span class="tag members">Members Only</span>
          <button>View Recipe</button>
        </div>
      </div>
      <div class="recipe-card">
        <img src="Egg-Muffins-1.jpg" alt="Egg Muffins" />
        <div class="recipe-content">
          <h3>Breakfast Egg Muffins</h3>
          <span class="tag free">Free</span>
          <button>View Recipe</button>
        </div>
      </div>
    </div>
  </section>

  <section id="plans" class="meal-plans-section">
    <h2>Weekly Meal Plans üßæ</h2>
    <div class="meal-plans-grid">
      <div class="plan-card">
        <div class="plan-front">
          <h3>Plan #1: Quick & Easy</h3>
          <p>30 min meals for busy days</p>
        </div>
        <div class="plan-back">
          <h4>Grocery List</h4>
          <ul>
            <li>Chicken breasts</li>
            <li>Fresh spinach</li>
            <li>Quinoa</li>
            <li>Garlic & herbs</li>
          </ul>
          <h4>Nutrition</h4>
          <p>Approx. 500 kcal/meal</p>
        </div>
      </div>
      <div class="plan-card">
        <div class="plan-front">
          <h3>Plan #2: Vegan Delight</h3>
          <p>Plant-based deliciousness</p>
        </div>
        <div class="plan-back">
          <h4>Grocery List</h4>
          <ul>
            <li>Chickpeas</li>
            <li>Kale</li>
            <li>Sweet potatoes</li>
            <li>Coconut milk</li>
          </ul>
          <h4>Nutrition</h4>
          <p>Approx. 450 kcal/meal</p>
        </div>
      </div>
    </div>
  </section>

  <section id="join" class="join-section">
    <h2>Become a Member üéâ</h2>
    <p>Only $5/month to access all recipes, videos, and live sessions!</p>
  </section>

  <footer>
    <p>&copy; 2025 Cook Along Club. All rights reserved.</p>
  </footer>

  <script>
    // Redirect login button to login page
    document.getElementById('loginBtn').addEventListener('click', () => {
      window.location.href = "login.html";
    });

    // JOIN NOW ‚Üí Stripe Checkout via your deployed Worker
    document.getElementById('joinBtn').addEventListener('click', async () => {
      const user = firebase.auth().currentUser;
      if (!user) {
        alert("Please sign in first!");
        return;
      }

      try {
        const response = await fetch("https://stripe-webhook.cookaloneclub-webhook.workers.dev/create-checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId: user.uid }) // Worker expects userId
        });

        if (!response.ok) throw new Error("Network response was not ok");

        const data = await response.json();
        if (data.id) {
          stripe.redirectToCheckout({ sessionId: data.id });
        } else {
          alert("Failed to start checkout.");
        }

      } catch (err) {
        console.error("Error creating checkout session:", err);
        alert("Failed to contact payment server.");
      }
    });

    // Logout button
    const logoutBtn = document.getElementById('logoutBtn');
    logoutBtn.addEventListener('click', () => {
      firebase.auth().signOut();
    });

    // Auth state change handler
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        document.getElementById('loginBtn').style.display = 'none';
        const profileWrapper = document.getElementById('profileWrapper');
        profileWrapper.style.display = 'flex';
        document.getElementById('userPic').src = user.photoURL || 'https://via.placeholder.com/36';
      } else {
        document.getElementById('loginBtn').style.display = 'inline-block';
        const profileWrapper = document.getElementById('profileWrapper');
        profileWrapper.style.display = 'none';
      }
    });
  </script>
</body>
</html>